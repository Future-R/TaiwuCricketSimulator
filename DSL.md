
# 促织技能 DSL 配置指南

本模拟器支持使用自然语言风格的脚本语言来定义促织技能的逻辑。

## 语法结构

一条完整的技能指令通常由 **触发时机** + **判断条件** + **执行动作** 组成，不同部分之间用中文逗号 `，` 分隔，不同指令之间用分号 `；` 分隔。

```
[触发时机]，[判断条件]，[执行动作]；
```

### 范例

- **养剑**：`造成伤害后，若本次攻击为非暴击，若概率触发(50%)，层数增加10；计算属性时，若属性为暴击伤害，结果=基础值+层数`
- **红莲**：`防御时，若概率触发(66%)，反弹100%伤害`
- **玄甲**：`回合开始时，造成200%回合数的体力损伤，造成200%回合数的斗性损伤`

---

## 关键字详解

### 1. 触发时机 (Trigger)

技能在何时发动。每条指令必须包含或隐含一个触发时机。

| 关键字 | 对应逻辑 |
| :--- | :--- |
| `战斗开始时` / `决斗开始时` | 双方入场，正式战斗前 |
| `回合开始时` | 每一轮比拼气势前 |
| `攻击前` | 计算命中/暴击前 |
| `防御时` | 受到攻击即将计算伤害前 (可用于格挡、反弹) |
| `受到...损伤时` | 受到伤害并即将扣血时 (可用于抵消) |
| `造成...损伤后` | 攻击结算完成，对方扣血后 (用于叠层、追击) |
| `受到...损伤后` / `被进攻时` | 自身扣血后 (用于反击、叠层) |
| `计算属性时` | 系统获取面板数值时 (用于被动加成) |
| `战败时` | 自身血量/斗性/耐久归零时 |
| `对手...技能时` | 对手发动技能时（特殊：仅限天光逻辑） |

### 2. 判断条件 (Condition)

限制动作执行的条件，支持多个条件叠加（逻辑与）。

| 关键字 | 说明 |
| :--- | :--- |
| `若概率触发(N%)` | N% 概率通过 |
| `若自身[属性][<|>][数值]` | 属性判断，如 `若自身体力<50%` |
| `若本次攻击为[类型]` | 类型包括：`暴击`、`非暴击`、`反击`、`牙钳`、`气势` |
| `若属性为[属性]` | 仅用于`计算属性时`，如 `若属性为角力` |
| `若未被格挡` | 仅用于攻击相关触发器 |

### 3. 执行动作 (Action)

满足条件后执行的效果。

| 关键字 | 说明 | 示例 |
| :--- | :--- | :--- |
| `恢复[数值][属性]` | 治疗自身 | `恢复10点体力` |
| `造成[数值][损伤]` | 伤害对手 | `造成100%伤害量的体力损伤` |
| `层数增加/减少[数值]` | 修改当前技能的堆叠层数 | `层数增加10` |
| `清除层数` | 清空当前技能层数 | `清除层数` |
| `结果=[表达式]` | 修改属性计算结果 | `结果=基础值+层数` |
| `反弹[数值]伤害` | 反弹即将受到的伤害（减伤后） | `反弹100%伤害` |
| `抵消[数值]伤害` | 免疫伤害 | `抵消全部伤害` |
| `避免[类型]` | 强制改变战斗结果 | `避免格挡` (必定命中) |

### 4. 数值表达式

在动作中引用动态数值。

- `基础值`：当前属性的原始值
- `层数`：当前技能累积的层数
- `伤害量`：本次攻击/受击的伤害总值
- `回合数`：当前战斗回合数
- `50%` / `100%`：比例系数

## 注意事项

- 对于无法完全用 DSL 描述的复杂技能（如“舍身”的动态倍率、“奇赋”的随机属性翻倍），逻辑仍在代码中硬编码实现，但概率判断已内嵌至逻辑函数中。
